<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{backend/layouts/base :: base(~{this::content})}">
    <th:block th:fragment="content">
        <div class="search_bar_wrap">
            <form action="" class="display_add_form" th:action th:object="${display}" method="post" enctype="multipart/form-data">
            <div class="search_date_wrap">
                <div class="item">
                    <h2>전시관리</h2>
                </div>
                <div class="item">
                    <button th:onclick="history.go(-1)" class="grey_btn">취소</button>
                    <button type="submit" class="black_btn">저장</button>
                </div>
            </div>
            <div class="add_form_wrap">

                <div class="add_input_wrap" style="display:none;">
                    <p>전시아이디</p>
                    <input type="text" th:field="*{displayId}" readonly>
                </div>

                <div class="add_input_wrap">
                    <p>1984소개이미지_01</p>
                    <div id="drop_zone01" class="drag_img_form">
                        <img id="image-preview01" class="preview-img" alt="" th:src="|/cms/displayimages/${display.getAboutImg01Stored}|">
                    </div>
                    <span class="drop_zone_ph">수정하시려면 영역 안으로 이미지를 추가해주세요.</span>
                    <input type="text" th:value="${display.aboutImg01Org}" class="image-input-form display-img-01" placeholder="이미지를 첨부해주세요." readonly>
                </div>
                <div class="add_input_wrap">
                    <p>소개텍스트_01</p>
                    <textarea th:field="*{aboutText01}"></textarea>
                </div>
                <div class="add_input_wrap">
                    <p>소개텍스트_02</p>
                    <textarea th:field="*{aboutText02}"></textarea>
                </div>
                <div class="add_input_wrap">
                    <p>소개텍스트_03</p>
                    <textarea th:field="*{aboutText03}"></textarea>
                </div>
                <div class="add_input_wrap">
                    <p>소개텍스트_04</p>
                    <textarea th:field="*{aboutText04}"></textarea>
                </div>
                <br>

                <div class="add_input_wrap">
                    <p>1984소개이미지_02</p>
                    <div id="drop_zone02" class="drag_img_form">
                        <img id="image-preview02" class="preview-img" alt="" th:src="|/cms/displayimages/${display.getAboutImg02Stored}|">
                    </div>
                    <span class="drop_zone_ph">수정하시려면 영역 안으로 이미지를 추가해주세요.</span>
                    <input type="text" th:value="${display.aboutImg02Org}" class="image-input-form display-img-02" placeholder="이미지를 첨부해주세요." readonly>
                </div>
                <div class="add_input_wrap">
                    <p>소개텍스트_05</p>
                    <textarea th:field="*{aboutText05}"></textarea>
                </div>
                <div class="add_input_wrap">
                    <p>소개텍스트_06</p>
                    <textarea th:field="*{aboutText06}"></textarea>
                </div>
                <br>

                <h3 class="input_wrap_h3">메인 서점 전시</h3>
                <div class="add_input_wrap">
                    <p>서점 01</p>
                    <select th:field="*{mainStore01}">
                        <option
                                th:each="stlist : ${storeLists}"
                                th:value="${stlist.storeId}"
                                th:utext="${stlist.storeTitle}"
                        ></option>
                    </select>
                </div>
                <div class="add_input_wrap">
                    <p>서점 02</p>
                    <select th:field="*{mainStore02}">
                        <option
                                th:each="stlist : ${storeLists}"
                                th:value="${stlist.storeId}"
                                th:utext="${stlist.storeTitle}"
                        ></option>
                    </select>
                </div>
                <div class="add_input_wrap">
                    <p>서점 03</p>
                    <select th:field="*{mainStore03}">
                        <option
                                th:each="stlist : ${storeLists}"
                                th:value="${stlist.storeId}"
                                th:utext="${stlist.storeTitle}"
                        ></option>
                    </select>
                </div>
                <div class="add_input_wrap">
                    <p>서점 04</p>
                    <select th:field="*{mainStore04}">
                        <option
                                th:each="stlist : ${storeLists}"
                                th:value="${stlist.storeId}"
                                th:utext="${stlist.storeTitle}"
                        ></option>
                    </select>
                </div>
                <div class="add_input_wrap">
                    <p>서점 05</p>
                    <select th:field="*{mainStore05}">
                        <option
                                th:each="stlist : ${storeLists}"
                                th:value="${stlist.storeId}"
                                th:utext="${stlist.storeTitle}"
                        ></option>
                    </select>
                </div>
                <br>

                <h3 class="input_wrap_h3">메인 도서 전시</h3>
                <div class="add_input_wrap">
                    <p>도서 01</p>
                    <select th:field="*{mainBook01}">
                        <option
                                th:each="bolist : ${BookLists}"
                                th:value="${bolist.bookId}"
                                th:utext="${bolist.bookTitle}"
                        ></option>
                    </select>
                </div>
                <div class="add_input_wrap">
                    <p>도서 02</p>
                    <select th:field="*{mainBook02}">
                        <option
                                th:each="bolist : ${BookLists}"
                                th:value="${bolist.bookId}"
                                th:utext="${bolist.bookTitle}"
                        ></option>
                    </select>
                </div>
                <div class="add_input_wrap">
                    <p>도서 03</p>
                    <select th:field="*{mainBook03}">
                        <option
                                th:each="bolist : ${BookLists}"
                                th:value="${bolist.bookId}"
                                th:utext="${bolist.bookTitle}"
                        ></option>
                    </select>
                </div>
                <div class="add_input_wrap">
                    <p>도서 04</p>
                    <select th:field="*{mainBook04}">
                        <option
                                th:each="bolist : ${BookLists}"
                                th:value="${bolist.bookId}"
                                th:utext="${bolist.bookTitle}"
                        ></option>
                    </select>
                </div>
                <div class="add_input_wrap">
                    <p>도서 05</p>
                    <select th:field="*{mainBook05}">
                        <option
                                th:each="bolist : ${BookLists}"
                                th:value="${bolist.bookId}"
                                th:utext="${bolist.bookTitle}"
                        ></option>
                    </select>
                </div>
                <br>
            </div>
            </form>
        </div>
    </th:block>
</th:block>
<script>
    let fileList01 = [];
    let fileList02 = [];
    let files01 = null;
    let files02 = null;
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        document.getElementById('drop_zone01').addEventListener(eventName, preventDefaults, false);
        document.getElementById('drop_zone02').addEventListener(eventName, preventDefaults, false);
    });
    function preventDefaults (e) {
        e.preventDefault();
        e.stopPropagation();
    }
    ['dragenter', 'dragover'].forEach(eventName => {
        document.getElementById('drop_zone01').addEventListener(eventName, highlight, false);
        document.getElementById('drop_zone02').addEventListener(eventName, highlight, false);
    });
    function highlight(e) {
        document.getElementById('drop_zone01').style.backgroundColor = '#fafafa';
        document.getElementById('drop_zone02').style.backgroundColor = '#fafafa';
    }

    document.getElementById('drop_zone01').addEventListener('drop', handleDrop01, false);
    function handleDrop01(e) {
      let dt01 = e.dataTransfer;
      files01 = dt01.files;
      fileList01.push(files01); // 배열에 추가
      handleFiles01(files01);
    }
    function handleFiles01(files) {
      ([...files]).forEach(uploadFile01);
    }
    function uploadFile01(file) {
      document.querySelector('.display-img-01').value = file.name;

        // 이미지 미리보기
      let reader = new FileReader();
      reader.onloadend = function() {
        let img01 = document.getElementById('image-preview01');
        img01.src = reader.result;
      }
      reader.readAsDataURL(file);
    }

    document.getElementById('drop_zone02').addEventListener('drop', handleDrop02, false);
    function handleDrop02(e) {
      let dt02 = e.dataTransfer;
      files02 = dt02.files;
      fileList02.push(files02); // 배열에 추가
      handleFiles02(files02);
    }
    function handleFiles02(files) {
      ([...files]).forEach(uploadFile02);
    }
    function uploadFile02(file) {
      document.querySelector('.display-img-02').value = file.name;

        // 이미지 미리보기
      let reader = new FileReader();
      reader.onloadend = function() {
        let img02 = document.getElementById('image-preview02');
        img02.src = reader.result;
      }
      reader.readAsDataURL(file);
    }
</script>
<script>
    $(document).ready(function(){
        $(".display_add_form").on("submit", function(e){ //FORM SUBMIT 클릭이벤트
            e.preventDefault(); // 기본 제출 동작 막기
            let formData = new FormData();
            let displayImg01 = null;
            let displayImg02 = null;
            if(files01 != null){
                displayImg01 = files01[0];
                formData.append("aboutImg01", displayImg01);
            }
            if(files02 != null){
                displayImg02 = files02[0];
                formData.append("aboutImg02", displayImg02);
            }
            let displayId = $("#displayId").val();
            let aboutText01 = $("#aboutText01").val();
            let aboutText02 = $("#aboutText02").val();
            let aboutText03 = $("#aboutText03").val();
            let aboutText04 = $("#aboutText04").val();
            let aboutText05 = $("#aboutText05").val();
            let aboutText06 = $("#aboutText06").val();
            let mainBook01 = $("#mainBook01").val();
            let mainBook02 = $("#mainBook02").val();
            let mainBook03 = $("#mainBook03").val();
            let mainBook04 = $("#mainBook04").val();
            let mainBook05 = $("#mainBook05").val();
            let mainStore01 = $("#mainStore01").val();
            let mainStore02 = $("#mainStore02").val();
            let mainStore03 = $("#mainStore03").val();
            let mainStore04 = $("#mainStore04").val();
            let mainStore05 = $("#mainStore05").val();

            formData.append("displayId", displayId);
            formData.append("aboutText01", aboutText01);
            formData.append("aboutText02", aboutText02);
            formData.append("aboutText03", aboutText03);
            formData.append("aboutText04", aboutText04);
            formData.append("aboutText05", aboutText05);
            formData.append("aboutText06", aboutText06);
            formData.append("mainBook01", mainBook01);
            formData.append("mainBook02", mainBook02);
            formData.append("mainBook03", mainBook03);
            formData.append("mainBook04", mainBook04);
            formData.append("mainBook05", mainBook05);
            formData.append("mainStore01", mainStore01);
            formData.append("mainStore02", mainStore02);
            formData.append("mainStore03", mainStore03);
            formData.append("mainStore04", mainStore04);
            formData.append("mainStore05", mainStore05);

            $.ajax({ // Ajax통신
              type: "post",
              url: '/cms/display/modify',
              data: formData,
              contentType: false,
              processData: false,
              success: function(result){
                alert("수정되었습니다.");
                window.location.href = "/cms/display/detail";
                },
                error: function(e) {
                    console.log("실패...");
                    console.log(e);
                }
            }); // Ajax통신
        }); //FORM SUBMIT 클릭이벤트
    });
</script>
</html>