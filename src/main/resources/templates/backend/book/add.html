<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{backend/layouts/base :: base(~{this::content})}">
  <th:block th:fragment="content">
    <div class="search_bar_wrap">
      <form action="" th:action th:object="${bookForm}" method="post" enctype="multipart/form-data">
        <div class="search_date_wrap">
          <div class="item">
            <h2>상품등록</h2>
          </div>
          <div class="item">
            <button th:onclick="history.go(-1)" class="grey_btn">취소</button>
            <button type="submit" class="black_btn">저장</button>
          </div>
        </div>
        <div class="add_form_wrap">

          <!--TODO select로 변경-->
          <div class="add_input_wrap">
            <p>카테고리명</p>
            <select th:field="*{bookCategory}">
              <option
                      th:each="ctlist : ${categoryLists}"
                      th:value="${ctlist.bookCategoryId}"
                      th:utext="${ctlist.bookCategoryName}"
              ></option>
            </select>
          </div>
          
          <div class="add_input_wrap">
            <p>ISBN</p>
            <input type="text" th:field="*{isbn}" placeholder="ISBN을 입력해주세요.">
          </div>

          <div class="add_input_wrap">
            <p>도서표지</p>
            <div id="drop_zone" class="drag_img_form">
              <img id="image-preview" alt="">
              <button type="button" class="img_delete_btn" onclick="clickdelete()"></button>
            </div>
            <input type="text" th:field="*{bookImg}" class="image-input-form" placeholder="이미지를 첨부해주세요." readonly>

          </div>

          <div class="add_input_wrap">
            <p>도서명</p>
            <input type="text" th:field="*{bookTitle}" placeholder="도서명을 입력해주세요.">
          </div>
          <div class="add_input_wrap">
            <p>목차</p>
            <textarea th:field="*{bookIndex}" placeholder="목차를 입력해주세요."></textarea>
          </div>
          <div class="add_input_wrap">
            <p>도서소개</p>
            <textarea th:field="*{bookIntro}" placeholder="도서소개를 입력해주세요."></textarea>
          </div>
          <br>
          <div class="add_input_wrap">
            <p>저자</p>
            <input type="text" th:field="*{bookWriter}" placeholder="저자를 입력해주세요.">
          </div>
          <div class="add_input_wrap">
            <p>저자소개</p>
            <textarea th:field="*{bookWriterProfile}" placeholder="저자소개를 입력해주세요."></textarea>
          </div>
          <br>
          <div class="add_input_wrap">
            <p>출판사</p>
            <input type="text" th:field="*{bookPub}" placeholder="출판사를 입력해주세요.">
          </div>

          <div class="add_input_wrap">
            <p>서점명</p>
            <select th:field="*{store}">
              <option
                      th:each="stlist : ${storeLists}"
                      th:value="${stlist.storeId}"
                      th:utext="${stlist.storeTitle}"
              ></option>
            </select>
          </div>

          <div class="add_input_wrap">
            <p>독립서점 리뷰</p>
            <textarea th:field="*{bookReview}" placeholder="독립서점의 리뷰를 입력해주세요."></textarea>
          </div>
          <br>
          <div class="add_input_wrap">
            <p>책파일</p>
            <input type="text" th:field="*{bookFile}" placeholder="*PDF 파일만 첨부가 가능합니다." class="text_drag">
          </div>
          <div class="add_input_wrap">
            <p>전자도서 판매가</p>
            <input type="text" th:field="*{bookEbookPrice}" placeholder="전자도서 판매가를 입력해주세요.">
          </div>
          <div class="add_input_wrap">
            <p>일반도서 판매가</p>
            <input type="text" th:field="*{bookPaperPrice}" placeholder="일반도서 판매가를 입력해주세요.">
          </div>
          <div class="add_checkbox_wrap">
            <p>활성화</p>
            <input type="radio" th:field="*{bookStatus}" value="ON">활성화
            <input type="radio" th:field="*{bookStatus}" value="OFF">비활성화
          </div>
        </div>
      </form>
    </div>
  </th:block>
</th:block>
<script>
  // Prevent default drag behaviors
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    document.getElementById('drop_zone').addEventListener(eventName, preventDefaults, false)
  });

  function preventDefaults (e) {
    e.preventDefault()
    e.stopPropagation()
  }

  // Highlight drop area when item is dragged over it
  ['dragenter', 'dragover'].forEach(eventName => {
    document.getElementById('drop_zone').addEventListener(eventName, highlight, false)
  });
  ['dropleave'].forEach(eventName => {
    document.getElementById('drop_zone').addEventListener(eventName, highlightlv, false)
  });
  ['drop'].forEach(eventName => {
    document.getElementById('drop_zone').addEventListener(eventName, unhighlight, false)
  });

  function highlight(e) {
    document.getElementById('drop_zone').style.backgroundColor = '#fafafa';
  }

  function highlightlv(e) {
    document.getElementById('drop_zone').style.backgroundColor = '#ffffff';
  }

  function unhighlight(e) {
    document.getElementById('drop_zone').style.backgroundColor = '#dcdcdc';
  }

  // Handle dropped files
  document.getElementById('drop_zone').addEventListener('drop', handleDrop, false);

  function handleDrop(e) {
    let dt = e.dataTransfer;
    let files = dt.files;

    handleFiles(files);
  }

  function handleFiles(files) {
    ([...files]).forEach(uploadFile);
  }

  function uploadFile(file) {
    document.getElementById('bookImg').value = file.name;

      // 이미지 미리보기
    let reader = new FileReader();
    reader.onloadend = function() {
      let img = document.getElementById('image-preview');
      let deleteBtn = document.querySelector('.img_delete_btn');
      let dropZone = document.getElementById('drop_zone');
      img.src = reader.result;
      deleteBtn.style.display = 'block';
<!--      dropZone.style.backgroundImage = 'url()';-->
    }
    reader.readAsDataURL(file);
  }

  function clickdelete(e){
    // 이미지 삭제 버튼에 클릭 이벤트 리스너 추가
    document.querySelector('.img_delete_btn').addEventListener('click', function() {
      // 이미지 미리보기 초기화
      document.getElementById('image-preview').src = '';

      // 'bookImg' 요소의 값 초기화
      document.getElementById('bookImg').value = '';

      //버튼 다시 삭제
      document.querySelector('.img_delete_btn').style.display = 'none';

      // 드래그 배경 색 수정
      document.getElementById('drop_zone').style.backgroundColor = '#ffffff';
<!--      let bgImgUrl = "../img/img_drag.png";-->
<!--      let dropZone = document.getElementById('drop_zone');-->
<!--      dropZone.style.backgroundImage = "url('" + bgImgUrl + "')";-->

      // 이미지 삭제 버튼 숨기기
      this.style.display = 'none';
    });
  }



</script>
<script>
  function upload() {
  const imageInput = $("#imageInput")[0];
  // 파일을 여러개 선택할 수 있으므로 files 라는 객체에 담긴다.
  console.log("imageInput: ", imageInput.files)

  if(imageInput.files.length === 0){
    alert("파일은 선택해주세요");
    return;
  }

  const formData = new FormData();
  formData.append("image", imageInput.files[0]);


  $.ajax({
    type:"POST",
    url: "function upload() {
  const imageInput = $("#imageInput")[0];
  // 파일을 여러개 선택할 수 있으므로 files 라는 객체에 담긴다.
  console.log("imageInput: ", imageInput.files)

  if(imageInput.files.length === 0){
    alert("파일은 선택해주세요");
    return;
  }

  const formData = new FormData();
  formData.append("image", imageInput.files[0]);


  $.ajax({
    type:"POST",
    url: "/Users/hoseonyoo/Documents/hoseon/project1984/project1984/src/main/resources/static/files",
    processData: false,
    contentType: false,
    data: formData,
    success: function(rtn){
      const message = rtn.data.values[0];
      console.log("message: ", message)
      $("#resultUploadPath").text(message.uploadFilePath)
    },
    err: function(err){
      console.log("err:", err)
    }
  })
}",
    processData: false,
    contentType: false,
    data: formData,
    success: function(rtn){
      const message = rtn.data.values[0];
      console.log("message: ", message)
      $("#resultUploadPath").text(message.uploadFilePath)
    },
    err: function(err){
      console.log("err:", err)
    }
  })
}
</script>
</html>